---
layout: post
title: Reaping the Benefits of the LoaderManager
date: 2012-05-26
comments: false
---

<h1>{{ page.title }}</h1>
<div class='post'>
<p><b>Note: <a href="http://www.androiddesignpatterns.com/2012/07/loaders-and-loadermanager-background.html">Check out my new posts on Loaders here!</a> (Since writing this post, I've written extensively on Loaders and the LoaderManager).</b></p> <p>With Android 3.0 came the introduction of the <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> class, an abstract class associated with an <span style="font-family: 'Courier New', Courier, monospace;">Activity</span> or <span style="font-family: 'Courier New', Courier, monospace;">Fragment</span> for managing one or more <span style="font-family: 'Courier New', Courier, monospace;">Loader</span> instances. The <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> class is one of my favorite additions to the Android framework for a number of reasons, but mostly because it <i>significantly</i> reduces code complexity and makes your application run a lot smoother. Implementing data loaders with the <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> is simple to implement, and takes care of everything about lifecycle management so are much less error prone.</p> <p>While applications are free to write their own loaders for loading various types of data, the most common (and simplest) use of the <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> is with a <span style="font-family: 'Courier New', Courier, monospace;">CursorLoader</span>. When done correctly, the <span style="font-family: 'Courier New', Courier, monospace;">CursorLoader</span> class offloads the work of loading data on a thread, and keeps the data persistent during short term activity refresh events, such as an orientation change. In addition to performing the initial query, the <span style="font-family: 'Courier New', Courier, monospace;">CursorLoader</span>&nbsp;registers a <span style="font-family: 'Courier New', Courier, monospace;">ContentObserver</span>&nbsp;with the dataset you requested and calls <span style="font-family: 'Courier New', Courier, monospace;">forceLoad()</span> on itself when the data set changes, and is thus auto-updating. This is extremely convenient for the programmer, as he doesn't have to worry about performing these queries himself. Further, for bigger screens it becomes more important that you query on a separate thread since configuration changes involve recreating the entire view layout, a complex operation that can cause disasters when blocked.</p><a name='more'></a> <p>As mentioned earlier, one could implement his or her class to load data on a separate thread using an <span style="font-family: 'Courier New', Courier, monospace;">AsyncTask</span> or even a <span style="font-family: 'Courier New', Courier, monospace;">Thread</span> (God help us). The point, however, is that the <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> does this all for you, so it's convenient for the developer, less error prone, and simple to implement. Of course it is possible to use an <span style="font-family: 'Courier New', Courier, monospace;">AsyncTask</span>&nbsp;to keep your application UI thread friendly, but it will involve a lot more code, and implementing your class so that it will retain the loaded <span style="font-family: 'Courier New', Courier, monospace;">Cursor</span>&nbsp;over the twists and turns of the <span style="font-family: 'Courier New', Courier, monospace;">Activity</span> lifecycle won't be simple. The bottom line is that <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span>&nbsp;will do this automatically for you, as well as taking care of correctly creating and closing the <span style="font-family: 'Courier New', Courier, monospace;">Cursor</span> based on the <span style="font-family: 'Courier New', Courier, monospace;">Activity</span>&nbsp;lifecycle.</p> <p>To use <span style="font-family: 'Courier New', Courier, monospace;">LoaderManager</span> with (or without) the <span style="font-family: 'Courier New', Courier, monospace;">CursorLoader</span> in an app targeting pre-HoneyComb devices, you should make use of the classes provided in the Android Support Package, including the <span style="font-family: 'Courier New', Courier, monospace;">FragmentActivity</span> class. A <span style="font-family: 'Courier New', Courier, monospace;">FragmentActivity</span>&nbsp;is just an <span style="font-family: 'Courier New', Courier, monospace;">Activity</span>&nbsp;that has been created for Android compatibility support, and does not require the use of fragments&nbsp;in your application. When transitioning from an <span style="font-family: 'Courier New', Courier, monospace;">Activity</span>s to <span style="font-family: 'Courier New', Courier, monospace;">FragmentActivity</span>s, be extremely careful that you use the&nbsp;<span style="font-family: 'Courier New', Courier, monospace;">getSupportLoaderManager()</span>&nbsp;instead of <span style="font-family: 'Courier New', Courier, monospace;">getLoaderManager()</span>. <span style="font-family: 'Courier New', Courier, monospace;">FragmentActivity</span> extends <span style="font-family: 'Courier New', Courier, monospace;">Activity</span>, thus inheriting all of its methods, and as a result the compiler will not complain if you accidentally mix up these methods, so be very careful!</p> <p>Leave a comment if you have any questions or criticisms... or just to let me know that you managed to read through this entire post without getting distracted! I'm also open to providing more explicit code samples if anyone asks.</p></div>
<h2>Comments</h2>
<div class='comments'>
<div class='comment'>
<div class='author'>martin</div>
<div class='content'>
Hi Alex,<br />and what if I have to develop against API Level 10? <br /><br />My application has an own ContentProvider. This provider uses a database which is based on some Json data. This data is loaded in a separate thread since there is a lot of data. Since I  have to develop against API Level 10 I cannot use the LoaderManager. What is the best way to have a content provider loading data asynchronusly. Is there any way to notify the cursor about new data in the database?<br /><br />Thanks for your help :)</div>
</div>
<div class='comment'>
<div class='author'>Alex Lockwood</div>
<div class='content'>
Fragments are reusable UI components... you should implement your Fragments so that they have no knowledge of the underlying Activity as well as any other Fragments that are being displayed. Initialize the loaders in the Fragment&#39;s onCreate() instead. :)</div>
</div>
<div class='comment'>
<div class='author'>André</div>
<div class='content'>
Hi! I have a question:<br /><br />I have a FragmentActivity which have 2 fragments. Each Fragment has its own listview that shows data from a database. Can I implement the LoaderManager.LoaderCallbacks interface on the fragments and initialize the loaders on the onCreate() of those fragments or I should do this on the FragmentActivity?</div>
</div>
<div class='comment'>
<div class='author'>Rose Reed</div>
<div class='content'>
This constructor is deprecated. This option is discouraged, as it results in Cursor queries being performed on the application&#39;s UI thread and thus can cause poor responsiveness or even Application Not Responding errors. As an alternative, use LoaderManager with a CursorLoader.</div>
</div>
<div class='comment'>
<div class='author'>Alex Lockwood</div>
<div class='content'>
Have you included the <i>notifyChange(uri, null)</i> in your content provider&#39;s <i>insert</i>, <i>update</i>, and <i>delete</i> methods? This is usually how the loader knows that it needs to be updated, as <i>CursorAdapter</i>&#39;s will receive these notifications by default. I&#39;m thinking of blogging about the specific chain of commands that gets executed in the future, but the important thing to understand for now is that the <i>LoaderManager</i> does this all behind the scenes.</div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>
Hey Alex. Great post. I do have a question about how Loaders manage themselves through ContentObserver. When does it refresh? For example. If I have a cursor with a bunch of names from profiles in the SQLite database locally, does it refresh when a new row is added? Just a little clarification on that front. Thanks.</div>
</div>
<div class='comment'>
<div class='author'>Michał K</div>
<div class='content'>
I was about to start a blog myself to cover many issues I encountered while learning to develop in android, but it never worked out. I will definitely recommend your blog posts on SO if I find out that people have problems you mention. And I think that if you write about nice solutions to problems which didn&#39;t receive too much attention yet (such as LoaderManager - there are many like this, because the platform is changing rapidly), you&#39;ll get popularity anyway.</div>
</div>
<div class='comment'>
<div class='author'>Alex Lockwood</div>
<div class='content'>
Now that you mention it, I found it somewhat difficult to learn at first as well... I remember it being difficult to find resources on how to transition from manually managing a Cursor to having the LoaderManager callbacks managing it automatically. I have a lot of ideas on posts/tutorials to write, so I&#39;ll add it to the list!<br /><br />Thanks for the comment, Michal! And don&#39;t hesitate to let people know about the blog either. Comments like these motivate me a lot more to write since I know there are people out there reading my posts!</div>
</div>
<div class='comment'>
<div class='author'>Michał K</div>
<div class='content'>
And do post some code if you can. When I started changing my code to use Loaders I found it really difficult to find any good resources. It should help people start using it and would probably boost the popularity of your blog:)</div>
</div>
<div class='comment'>
<div class='author'>Michał K</div>
<div class='content'>
I thought that I&#39;m the only one fighting the battle to drop AsyncTask and move on to Loaders (on StackOverflow). There are so many benefits, including ones that you mention.<br /><br />As to the content of the post itself - as far as I know not only CursorLoader keeps your data persistent across configuration changes. Every other Loader does.<br /><br />And btw - read all of the three posts and I&#39;m happy to find out, that I use all three design patterns in my app:)</div>
</div>
</div>
